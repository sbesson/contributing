Jekyll hosted websites
======================

A number of OME websites are produced using `Jekyll <http://jekyllrb.com/>`_,
including:

- `Main OME website <https://www.openmicroscopy.org/>`_
- `OME blog <http://blog.openmicroscopy.org/>`_
- `OME Help site <http://help.openmicroscopy.org/>`_
- `OMERO.figure website <http://figure.openmicroscopy.org/>`_

These sites can be built and tested by installing a local copy of Jekyll.
The Help and Figure sites are also built by CI jobs, see :doc:`ci-docs`.

The publicly released pages are hosted and automatically generated by
`GitHub Pages <https://pages.github.com/>`_ with a `custom subdomain
<https://help.github.com/articles/about-custom-domains-for-github-pages-sites/>`_.

Installing Jekyll
-----------------

Jekyll can be installed as a system application (requires administrator
privileges) or for a single user.

1. Install a recent version of Ruby. Recent versions of OS X and Linux may
   already include a suitable version, however you will require
   administrator privileges to install Jekyll.
   Alternatively on OS X you can use Homebrew, and on Linux either `rbenv
   <https://github.com/sstephenson/rbenv>`_ or `RVM <https://rvm.io/>`_::

       brew install ruby

2. Install Jekyll::

       gem install jekyll


Running Jekyll
--------------

In a terminal enter the local git checkout and run::

    jekyll serve -w -b ''

This will build the web pages and start a local server on
http://localhost:4000/.
Jekyll should automatically rebuild the pages when changes are made to the
source files, and will override any `baseurl` defined in `_config.yml`.

Editing the websites
--------------------

Main OME Website
^^^^^^^^^^^^^^^^

The source for `www.openmicroscopy.org <https://www.openmicroscopy.org>`_ is
on GitHub at `<https://github.com/openmicroscopy/www.openmicroscopy.org>`_.
The website uses the ‘master’ branch, PRs should be opened directly against
it.

Once a PR is open and has passed Travis, you can build the staging site for
review by triggering the
`WWW-merge <https://ci.openmicroscopy.org/view/Mgmt/job/WWW-merge/>`_ job. The
site will be viewable at
`<https://snoopycrimecop.github.io/www.openmicroscopy.org/>`_.

Once the PR is merged, the live site can currently only be updated by one of
the sysadmin team running a
`playbook <https://github.com/openmicroscopy/prod-playbooks/tree/master/www>`_
to update the deployment.

OME Blog
^^^^^^^^

The source for `blog.openmicroscopy.org <http://blog.openmicroscopy.org>`_ is
at `<https://github.com/ome/blog>`_.
The website uses the 'gh-pages' branch and as there is no merge build or
staging page, you should open a PR directly against this branch. Branches must
be built locally for review and merging PRs automatically updates the live
site.

Help site
^^^^^^^^^

`help.openmicroscopy.org <http://help.openmicroscopy.org>`_ covers OMERO user
guides illustrated with screenshots and also an introduction for facility
managers aimed at signposting them to parts of the sysadmin docs without
burying them in technical details from the start. Increasingly these are
supplemented with video content and moving forward movies and training
presentations may become the default format for new workflows.

The source is at `<https://github.com/openmicroscopy/ome-help/>`_.
The website uses the ‘gh-pages’ branch for the live deployment but PRs should
be opened against 'master' for review.

Once a PR is open against the ‘master’ branch and has passed Travis, you can
build the staging site for review by triggering the
`OME-help-staging <https://ci.openmicroscopy.org/view/Docs/job/OME-help-staging/>`_ job. The
site will be viewable at `<http://help.staging.openmicroscopy.org>`_.

Once the PR is merged, running the
`OME-help-release <https://ci.openmicroscopy.org/view/Docs/job/OME-help-release/>`_ build will
open a PR to transfer the content to the ‘gh-pages’ branch. Once that PR is
merged, the live site will be updated automatically.

Figure website
^^^^^^^^^^^^^^

`<http://figure.openmicroscopy.org/>`_ is now mostly a legacy site from before
OMERO.figure was considered a core part of the project. It will likely be
merged into the main website in the future but for now it hosts a live demo,
installation instructions, release announcements and other OMERO.figure
related blog posts.

The source is at `<https://github.com/ome/omero-figure/>`_.
The live website uses the ‘gh-pages’ branch but PRs should be opened against
'gh-pages-staging' for review.

Once a PR is open against the ‘gh-pages-staging’ branch, you can build the
staging site for review by triggering the
`FIGURE-help-staging <https://ci.openmicroscopy.org/view/Docs/job/FIGURE-help-staging>`_ job. The
site will be viewable at `<http://figure.staging.openmicroscopy.org>`_.

Once the PR is merged, running the
`FIGURE-help-release <https://ci.openmicroscopy.org/view/Docs/job/FIGURE-help-release/>`_ build
will open a PR to transfer the content to the ‘gh-pages’ branch. Once that PR
is merged, the live site will be updated automatically.
