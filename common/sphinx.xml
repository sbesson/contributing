<!--
build.xml

Ant build file for Bio-Formats Sphinx documentation.
Download Apache Ant from http://ant.apache.org/.
Type "ant -p" for a list of targets.
-->

<project>
  <description>Sphinx macros</description>

  <property name="sphinx.build" value="sphinx-build"/>
  <property name="sphinx.opts" value=""/>
  <property name="sphinx.builddir" location="_build"/>
  <property name="latex.opts" value=""/>

  <!-- Non-core ant tasks -->

  <!-- Ant-Contrib Tasks: http://ant-contrib.sourceforge.net/ -->
  <taskdef resource="net/sf/antcontrib/antcontrib.properties"
    classpath="${lib.dir}/ant-contrib-1.0b3.jar"/>
  <!-- HACK - some environments do not install the antcontrib tasks properly
    from antcontrib.properties above; also load them from antlib.xml -->
  <taskdef resource="net/sf/antcontrib/antlib.xml"
    classpath="${lib.dir}/ant-contrib-1.0b3.jar"/>

  <macrodef name="xelatex" description="Run XeLaTeX">
    <attribute name="file" default=""/>
    <sequential>
      <basename property="file.basename" file="@{file}"/>
      <dirname property="file.dirname" file="@{file}"/>
      <exec executable="xelatex" failonerror="true" dir="${file.dirname}">
        <arg line="${latex.opts}"/>
        <arg value="${file.basename}"/>
      </exec>
    </sequential>
  </macrodef>

  <macrodef name="makeindex" description="Run makeindex">
    <attribute name="file" default=""/>
    <sequential>
      <basename property="file.basename" file="@{file}"/>
      <dirname property="file.dirname" file="@{file}"/>
      <propertyregex property="file.index" input="${file.basename}" regexp="(.*)\.tex" select="\1.idx"/>
      <echo message="BN: ${file.basename}  IN: ${file.index}"/>
      <exec executable="makeindex" failonerror="true" dir="${file.dirname}">
        <arg value="-s"/>
        <arg value="python.ist"/>
        <arg value="${file.index}"/>
      </exec>
    </sequential>
  </macrodef>

  <macrodef name="runlatex">
    <attribute name="file" default=""/>
    <sequential>
      <basename property="jar.filename" file="${lib.jarfile}"/>
      <xelatex file="@{file}"/>
      <xelatex file="@{file}"/>
      <makeindex file="@{file}"/>
      <xelatex file="@{file}"/>
      <xelatex file="@{file}"/>
      <xelatex file="@{file}"/>
    </sequential>
  </macrodef>

</project>
